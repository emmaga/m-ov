/*! m-ov | cc | ISC */
"use strict";String.prototype.parseQuerystring=function(){var a={},b=this.split("&");for(var c in b){var d=b[c].split("=");a[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return a},function(){angular.module("m-ov",["ionic","ui.router","app.filters","app.controllers","app.directive","app.services","pascalprecht.translate"]).config(["$translateProvider",function(a){var b="zh-CN"==navigator.language?navigator.language:"en-US";a.preferredLanguage(b),a.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/index"),a.state("index",{url:"/index",templateUrl:"pages/bookHotelList.html"}).state("bookRoomList",{url:"/bookRoomList",views:{"":{templateUrl:"pages/bookRoomList.html"}}}).state("bookHotelList",{url:"/bookHotelList:?sDate&eDate",views:{"":{templateUrl:"pages/bookHotelList.html"}}}).state("hotelInfo",{url:"/hotelInfo",views:{"":{templateUrl:"pages/hotelInfo.html"}}}).state("bookInfo",{url:"/bookInfo",views:{"":{templateUrl:"pages/bookInfo.html"}}}).state("bookResult",{url:"/bookResult",views:{"":{templateUrl:"pages/bookResult.html"}}}).state("bookRoomSoldOut",{url:"/bookRoomSoldOut",views:{"":{templateUrl:"pages/bookRoomSoldOut.html"}}}).state("memberHome",{url:"/memberHome",views:{"":{templateUrl:"pages/memberHome.html"}}}).state("memberLogin",{url:"/memberLogin",views:{"":{templateUrl:"pages/memberLogin.html"}}}).state("memberRegister",{url:"/memberRegister",views:{"":{templateUrl:"pages/memberRegister.html"}}}).state("memberInfoEdit",{url:"/memberInfoEdit",views:{"":{templateUrl:"pages/memberInfoEdit.html"}}}).state("memberResetPW",{url:"/memberResetPW",views:{"":{templateUrl:"pages/memberResetPW.html"}}}).state("memberOrderList",{url:"/memberOrderList",views:{"":{templateUrl:"pages/memberOrderList.html"}}})}]).constant("BACKEND_CONFIG",{serverUrl:"http://openvod.cleartv.cn/backend_wx/v1/",testUrl:"api/",testExtesion:".json",test:!0})}(),function(){angular.module("app.controllers",["ngCookies"]).controller("RootController",["$scope","$window","$http","$filter","$ionicModal","$translate","backendUrl",function(a,b,c,d,e,f,g){var h=this;h.params={},h.init=function(){var a=b.location.search.substring(1),c=a.parseQuerystring(),d=c.code,e=c.appid;h.setParams("appid",e),h.getUserID(d,e),h.wxConfigJSSDK(),h.wxShare=function(){setTimeout(function(){wx.onMenuShareAppMessage({title:"",desc:"",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+h.getParams("appid")+"&redirect_uri="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)+"&response_type=code&scope=snsapi_userinfo&state=&component_appid=wx5bfdc86d4b702418#wechat_redirect",imgUrl:"",type:"",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+h.getParams("appid")+"&redirect_uri="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)+"&response_type=code&scope=snsapi_userinfo&state=&component_appid=wx5bfdc86d4b702418#wechat_redirect",imgUrl:"",success:function(){},cancel:function(){}})},1e3)}},h.setParams=function(a,b){h.params[a]=b},h.getParams=function(a){return h.params[a]},h.getUserID=function(a,b){var e={appid:b,code:a};e=JSON.stringify(e),c.post(g("buildsession","server"),e).success(function(a,b,c,d){h.getWxUserInfo(a.access_token,a.openid)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},h.getWxUserInfo=function(a,b){var e=f.proposedLanguage()||f.use();e="zh-CN"==e?"zh_CN":"en";var i={access_token:a,openid:b,lang:e};i=JSON.stringify(i),c.post(g("wxuserinfo","server"),i).success(function(a,b,c,d){h.setParams("wxUserInfo",a)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},h.wxConfigJSSDK=function(){h.noncestr=Math.random().toString(36).substr(2),h.timestamp=(new Date).getTime()+"";var a={appid:h.getParams("appid"),noncestr:h.noncestr,timestamp:h.timestamp,url:window.location.origin+window.location.pathname+window.location.search};a=JSON.stringify(a),c.post(g("jssign","server"),a).success(function(a,b,c,e){"200"==a.rescode?wx.config({debug:!1,appId:h.getParams("appid"),timestamp:h.timestamp,nonceStr:h.noncestr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]}):alert(d("translate")("serverError")+a.rescode)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},e.fromTemplateUrl("pages/mainMenu.html",{scope:a,animation:"slide-in-left"}).then(function(b){a.modal=b}),h.showMainMenu=function(){a.modal.show()}}]).controller("bookHotelListController",["$scope","$timeout","$filter","$location","$http","$stateParams","backendUrl",function(a,b,c,d,e,f,g){var h=this;console.log(f.sDate+", "+f.eDate),h.init=function(){a.root.wxShare(),h.datePickerShow=!1,h.hotels={},h.checkin=(new Date).getTime(),h.checkout=(new Date).getTime()+864e5,h.cityLists=[{initials:"全部",lists:[{cityName:"全部",cityId:"0"}]},{initials:"A",lists:[{cityName:"阿尔山",cityId:"1"},{cityName:"阿克苏",cityId:"2"},{cityName:"澳门",cityId:"3"}]},{initials:"B",lists:[{cityName:"北京",cityId:"4"}]},{initials:"H",lists:[{cityName:"海口",cityId:"5"},{cityName:"杭州",cityId:"6"}]},{initials:"L",lists:[{cityName:"丽江",cityId:"7"}]},{initials:"S",lists:[{cityName:"上海",cityId:"8"},{cityName:"三亚",cityId:"9"},{cityName:"沈阳",cityId:"10"},{cityName:"石家庄",cityId:"11"},{cityName:"苏州",cityId:"12"}]}],h.cityInfo={id:"0",name:"全部"},h.search()},h.showDP=function(a){h.datePickerShow=!!a&&a},h.showCP=function(a){h.cityPickerShow=!!a&&a},h.doAfterPickDates=function(a,c){h.checkin=a,h.checkout=c,b(function(){h.showDP(!1)},500)},h.doAfterPickCity=function(a,b){h.cityInfo={id:a,name:b},h.showCP(!1)},h.search=function(){e({method:c("ajaxMethod")(),url:g("bookHotelList")}).then(function(a,b,c,d){console.log(a),h.hotels=a.data.lists,console.log(h.hotels)},function(a,b,c,d){alert(b)})}}]).controller("bookRoomListController",["$http","$filter","$scope",function(a,b,c){var d=this;d.init=function(){c.root.wxShare()},d.search=function(){a({method:b("ajaxMethod")(),url:backendUrl("bookRoomList")}).then(function(a,b,c,e){console.log(a),d.hotels=a.data.lists,console.log(d.hotels)},function(a,b,c,d){alert(b)})}}]).controller("hotelInfoController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("bookInfoController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("bookResultController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("bookRoomSoldOutController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberHomeController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberLoginController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberRegisterController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberInfoEditController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberResetPWController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberOrderListController",["$scope",function(a){var b=this;b.init=function(){a.root.wxShare()}}])}(),function(){angular.module("app.directive",[]).directive("cityPicker",function(){return{restrict:"EA",templateUrl:"pages/drt/city-picker.html",replace:!0}}).controller("cityPickerController",["$scope","$ionicScrollDelegate",function(a,b){var c=this;c.init=function(a,b){c.callback=b,c.cityLists=a},c.scrollTo=function(a){var c=document.getElementById(a).offsetTop;b.$getByHandle("cityList").scrollTo(0,c,!0)}}]).directive("travelDatePicker",function(){return{restrict:"EA",templateUrl:"pages/drt/travel-date-picker.html",replace:!0}}).controller("travelDatePickerController",["$scope","$filter",function(a,b){function c(a,b){var c=new Date(a),d=new Date(b);return c.getFullYear()===d.getFullYear()&&c.getMonth()==d.getMonth()&&c.getDate()==d.getDate()}function d(a){var a=new Date(a);return a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),a.getTime()}function e(a,b){var c=new Date(a,b-1,1),d=new Date(a,b,0),e=c.getDay()+d.getDate();return Math.ceil(e/7)}function f(a,b){var c=new Date(a);return c.setTime(a+24*b*60*60*1e3),c.getTime()}function g(a){switch(a.getMonth()+1){case 1:i(a.getFullYear())?a.setTime(f(a.getTime(),29)):a.setTime(f(a.getTime(),28));break;case 3:case 5:case 8:case 10:a.setTime(f(a.getTime(),30));break;case 12:case 2:case 4:case 6:case 7:case 9:case 11:a.setTime(f(a.getTime(),31))}}function h(a){a=new Date(a);var b=a.getFullYear(),c=a.getMonth()+1;return 12*(b-1970)+c}function i(a){return a%4==0&&(a%400==0||a%100!=0)}var j=this;j.init=function(a,c,d,e,f){j.st=d?d:(new Date).getTime(),j.et=e?e:j.st+158112e5,j.checkin=a,j.checkout=c,j.dates=[],j.callback=f,j.setDateData(),j.msgShow=!0,j.msg=b("translate")("plsSelACheckInDate")},j.setDateData=function(){for(var a=h(j.et)-h(j.st)+1,b=new Date(j.st),c=0;c<a;c++){j.dates[c]={},j.dates[c].month=b.getTime(),j.dates[c].weeks=[];for(var d=new Date(b.getFullYear(),b.getMonth()+1,0),i=d.getFullYear(),k=d.getMonth()+1,l=e(i,k),m=new Date(b.getFullYear(),b.getMonth(),1),n=m.getDay(),o=0;o<l;o++){j.dates[c].weeks[o]=[];for(var p=0;p<7;p++)n>0?(j.dates[c].weeks[o][p]=null,n--):m>d?j.dates[c].weeks[o][p]=null:(j.dates[c].weeks[o][p]=m.getTime(),m.setTime(new Date(f(m.getTime(),1)).getTime()))}g(b)}},j.clickDate=function(a){return!(j.dDisable(a)||c(a,j.checkin)||c(a,j.checkout))&&void(j.checkin&&j.checkout?(j.checkin=a,j.checkout=null,j.msgShow=!0,j.msg=b("translate")("plsSelACheckOutDate")):j.checkin&&!j.checkout?a<j.checkin?j.checkin=a:(j.checkout=a,j.msgShow=!1,j.msg="",j.callback(j.checkin,j.checkout)):j.checkin=a)},j.dDisable=function(a){var b=(new Date).getTime();return d(b)>d(a)||d(a)<d(j.st)||d(a)>d(j.et)},j.isDuring=function(a){var b=!1;return j.checkin&&j.checkout&&a>j.checkin&&a<j.checkout&&(b=!0),b},j.isCheckin=function(a){return!(!j.checkin||!c(j.checkin,a))},j.isCheckout=function(a){return!(!j.checkout||!c(j.checkout,a))}}])}(),function(){angular.module("app.services",[]).service("backendUrl",["BACKEND_CONFIG",function(a){return function(b,c){return a.test?"server"==c?a.serverUrl+b:a.testUrl+b+a.testExtesion:a.serverUrl+b}}])}(),function(){angular.module("app.filters",[]).filter("ajaxMethod",["BACKEND_CONFIG",function(a){return function(){var b=a.test?"GET":"POST";return b}}])}();