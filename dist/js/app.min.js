/*! m-ov | cc | ISC */
"use strict";String.prototype.parseQuerystring=function(){var a={},b=this.split("&");for(var c in b){var d=b[c].split("=");a[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return a},function(){angular.module("m-ov",["ionic","ui.router","app.filters","app.controllers","app.directive","app.services","pascalprecht.translate"]).config(["$translateProvider",function(a){var b="zh-CN"==navigator.language?navigator.language:"en-US";a.preferredLanguage(b),a.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/index"),a.state("index",{url:"/index",templateUrl:"pages/bookHotelList.html"}).state("bookRoomList",{url:"/bookRoomList/?hotelId&checkIn&checkOut",views:{"":{templateUrl:"pages/bookRoomList.html"}}}).state("bookHotelList",{url:"/bookHotelList:?sDate&eDate",views:{"":{templateUrl:"pages/bookHotelList.html"}}}).state("roomInfo",{url:"/roomInfo/?roomId&hotelId&checkIn&checkOut",views:{"":{templateUrl:"pages/roomInfo.html"}}}).state("orderInfo",{url:"/orderInfo",views:{"":{templateUrl:"pages/orderInfo.html"}}}).state("bookResult",{url:"/bookResult",views:{"":{templateUrl:"pages/bookResult.html"}}}).state("bookRoomSoldOut",{url:"/bookRoomSoldOut",views:{"":{templateUrl:"pages/bookRoomSoldOut.html"}}}).state("memberHome",{url:"/memberHome",views:{"":{templateUrl:"pages/memberHome.html"}}}).state("memberLogin",{url:"/memberLogin",views:{"":{templateUrl:"pages/memberLogin.html"}}}).state("memberRegister",{url:"/memberRegister",views:{"":{templateUrl:"pages/memberRegister.html"}}}).state("memberInfoEdit",{url:"/memberInfoEdit/?memberId",views:{"":{templateUrl:"pages/memberInfoEdit.html"}}}).state("memberResetPW",{url:"/memberResetPW",views:{"":{templateUrl:"pages/memberResetPW.html"}}}).state("memberOrderList",{url:"/memberOrderList",views:{"":{templateUrl:"pages/memberOrderList.html"}}})}]).constant("BACKEND_CONFIG",{serverUrl:"http://openvod.cleartv.cn/backend_wx/v1/",testUrl:"api/",testExtesion:".json",test:!0})}(),function(){angular.module("app.controllers",["ngCookies"]).controller("RootController",["$scope","$window","$http","$filter","$ionicModal","backendUrl",function(a,b,c,d,e,f){var g=this;g.params={},g.init=function(){var a=b.location.search.substring(1),c=a.parseQuerystring(),d=c.code,e=c.appid;g.setParams("appid",e),g.getUserID(d,e),g.wxConfigJSSDK()},g.setParams=function(a,b){g.params[a]=b},g.getParams=function(a){return g.params[a]},g.getUserID=function(a,b){var e={appid:b,code:a};e=JSON.stringify(e),c.post(f("buildsession","server"),e).success(function(a,b,c,d){g.getWxUserInfo(a.access_token,a.openid)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},g.getWxUserInfo=function(a,b){var e={access_token:a,openid:b,lang:"zh_CN"};c.post(f("wxuserinfo","server"),e).success(function(a,b,c,d){g.setParams("wxUserInfo",a)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},g.wxConfigJSSDK=function(){g.noncestr=Math.random().toString(36).substr(2),g.timestamp=(new Date).getTime()+"";var a={appid:g.getParams("appid"),noncestr:g.noncestr,timestamp:g.timestamp,url:window.location.origin+window.location.pathname+window.location.search};a=JSON.stringify(a),c.post(f("jssign","server"),a).success(function(a,b,c,e){"200"==a.rescode?wx.config({debug:!1,appId:g.getParams("appid"),timestamp:g.timestamp,nonceStr:g.noncestr,signature:a.signature,jsApiList:["getLocation"]}):alert(d("translate")("serverError")+a.rescode)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},e.fromTemplateUrl("pages/mainMenu.html",{scope:a,animation:"slide-in-left"}).then(function(b){a.modal=b}),g.showMainMenu=function(){a.modal.show()}}]).controller("bookHotelListController",["$scope","$filter","$location","$http","$stateParams","loadingService","backendUrl",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.showLoadingBool={},h.showLoadingBool.searchProjectInfoBool=!1,h.showLoadingBool.searchCityListsBool=!1,h.showLoadingBool.searchHotelListBool=!1,f(h.showLoadingBool),h.datePickerShow=!1,h.hotels={},h.checkin=(new Date).getTime(),h.checkout=(new Date).getTime()+864e5,h.cityInfo={id:"0",name:"全部"},h.searchProjectInfo(),h.searchHotelList(),h.searchCityLists()},h.showDP=function(a){h.datePickerShow=!!a&&a},h.showCP=function(a){h.cityPickerShow=!!a&&a},h.doAfterPickDates=function(a,b){h.checkin=a,h.checkout=b,h.showDP(!1)},h.doAfterPickCity=function(a,b){h.cityInfo={id:a,name:b},h.showCP(!1)},h.searchProjectInfo=function(){d({method:b("ajaxMethod")(),url:g("projectInfo")}).then(function(a,b,c,d){h.projectInfo=a.data.projectInfo,h.showLoadingBool.searchProjectInfoBool=!0,f(h.showLoadingBool)},function(a,b,c,d){h.showLoadingBool.searchProjectInfoBool=!0,f(h.showLoadingBool),alert(b)})},h.searchCityLists=function(){d({method:b("ajaxMethod")(),url:g("cityLists")}).then(function(a,b,c,d){h.cityLists=a.data.data.cityLists,h.showLoadingBool.searchCityListsBool=!0,f(h.showLoadingBool)},function(a,b,c,d){h.showLoadingBool.searchCityListsBool=!0,f(h.showLoadingBool),alert(b)})},h.searchHotelList=function(){d({method:b("ajaxMethod")(),url:g("hotelList")}).then(function(a,b,c,d){h.hotels=a.data.data.hotelLists,h.showLoadingBool.searchHotelListBool=!0,f(h.showLoadingBool)},function(a,b,c,d){h.showLoadingBool.searchHotelListBool=!0,f(h.showLoadingBool),alert(b)})}}]).controller("bookRoomListController",["$scope","$http","$filter","$stateParams","$timeout","loadingService","backendUrl",function(a,b,c,d,e,f,g){console.log("bookRoomListController");var h=this;h.init=function(){h.hotelId=d.hotelId,h.checkIn=d.checkIn,h.checkOut=d.checkOut,h.showLoadingBool={},h.showLoadingBool.searchHotelInfoBool=!1,h.showLoadingBool.searchRoomListBool=!1,f(h.showLoadingBool),h.searchHotelInfo(),h.searchRoomList()},h.searchHotelInfo=function(){e(function(){b({method:c("ajaxMethod")(),url:g("hotelInfo"),data:{hotelId:h.hotelId}}).then(function(a,b,c,d){h.hotel=a.data.data.hotel,h.showLoadingBool.searchHotelInfoBool=!0,f(h.showLoadingBool),console.log("searchHotelInfoBool")},function(a,b,c,d){h.showLoadingBool.searchHotelInfoBool=!0,f(h.showLoadingBool),alert(b)})},500)},h.searchRoomList=function(){b({method:c("ajaxMethod")(),url:g("roomList"),data:{hotelId:h.hotelId}}).then(function(a,b,c,d){h.rooms=a.data.data,h.showLoadingBool.searchRoomListBool=!0,f(h.showLoadingBool)},function(a,b,c,d){h.showLoadingBool.searchHotelInfoBool=!0,f(h.showLoadingBool),alert(b)})}}]).controller("roomInfoController",["$http","$filter","$stateParams","$timeout","loadingService","backendUrl",function(a,b,c,d,e,f){console.log("roomInfoController"),console.log(c);var g=this;g.init=function(){g.showLoadingBool={},g.showLoadingBool.searchBool=!1,e(g.showLoadingBool),g.checkin=c.checkIn,g.checkout=c.checkOut,g.search()},g.showDP=function(a){g.datePickerShow=!!a&&a},g.doAfterPickDates=function(a,b){g.checkin=a,g.checkout=b,g.showDP(!1)},g.search=function(){d(function(){a({method:b("ajaxMethod")(),url:f("roomInfo")}).then(function(a,b,c,d){console.log(a),g.room=a.data.data.room,g.showLoadingBool.searchBool=!0,e(g.showLoadingBool)},function(a,b,c,d){g.showLoadingBool.searchBool=!0,e(g.showLoadingBool),alert(b)})},500)},g.getAuthCode=function(){a({method:b("ajaxMethod")(),url:f("authCode")}).then(function(a,b,c,d){console.log(a)},function(a,b,c,d){alert(b)})}}]).controller("orderInfoController",["$http","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e){console.log("bookInfoController");var f=this;f.init=function(){f.showLoadingBool={},f.showLoadingBool.searchBool=!1,d(f.showLoadingBool),f.search()},f.search=function(){a({method:b("ajaxMethod")(),url:e("orderInfo")}).then(function(a,b,c,e){f.room=a.data.data.room,f.hotel=a.data.data.hotel,f.roomOrder=a.data.data.roomOrder,f.showLoadingBool.searchBool=!0,d(f.showLoadingBool)},function(a,b,c,e){f.showLoadingBool.searchBool=!0,d(f.showLoadingBool),alert(b)})}}]).controller("bookRoomSoldOutController",["$http",function(a){var b=this;b.init=function(){}}]).controller("memberHomeController",["$http","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e){console.log("memberHomeController");var f=this;f.init=function(){f.showLoadingBool={},f.showLoadingBool.searchBool=!1,f.showLoading(f.showLoadingBool.searchBool),f.search()},f.search=function(){a({method:b("ajaxMethod")(),url:e("memberInfo")}).then(function(a,b,c,d){console.log(a),f.member=a.data.data.member,console.log(f.member),f.showLoadingBool.searchBool=!0,f.showLoading(f.showLoadingBool.searchBool)},function(a,b,c,d){f.showLoadingBool.searchBool=!0,f.showLoading(f.showLoadingBool.searchBool),alert(b)})}}]).controller("memberLoginController",["$http",function(a){var b=this;b.init=function(){}}]).controller("memberRegisterController",["$http",function(a){var b=this;b.init=function(){}}]).controller("memberInfoEditController",["$http","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e){console.log("memberInfoEditController");var f=this;f.memberId=c.memberId,f.init=function(){f.showLoadingBool={},f.showLoadingBool.searchBool=!1,d(f.showLoadingBool),f.search()},f.search=function(){a({method:b("ajaxMethod")(),url:e("memberInfo"),data:{hotelId:c.hotelId,roomId:c.roomId}}).then(function(a,b,c,e){console.log(a),f.member=a.data.data.member,f.showLoadingBool.searchBool=!0,d(f.showLoadingBool)},function(a,b,c,e){f.showLoadingBool.searchBool=!0,d(f.showLoadingBool),alert(b)})},f.getAuthCode=function(){a({method:b("ajaxMethod")(),url:e("authCode")}).then(function(a,b,c,d){console.log(a)},function(a,b,c,d){alert(b)})}}]).controller("memberResetPWController",["$http",function(a){var b=this;b.init=function(){}}]).controller("memberOrderListController",["$http","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e){var f=this;f.init=function(){f.showLoadingBool={},f.showLoadingBool.searchBool=!1,d(f.showLoadingBool),f.search()},f.search=function(){a({method:b("ajaxMethod")(),url:e("orderList")}).then(function(a,b,c,e){console.log(a),f.orderLists=a.data.data.orderLists,f.showLoadingBool.searchBool=!0,d(f.showLoadingBool)},function(a,b,c,e){f.showLoadingBool.searchBool=!0,d(f.showLoadingBool),alert(b)})}}])}(),function(){angular.module("app.directive",[]).directive("cityPicker",function(){return{restrict:"EA",templateUrl:"pages/drt/city-picker.html",replace:!0}}).controller("cityPickerController",["$scope","$ionicScrollDelegate",function(a,b){var c=this;c.init=function(a,b){c.callback=b,c.cityLists=a},c.scrollTo=function(a){var c=document.getElementById(a).offsetTop;b.$getByHandle("cityList").scrollTo(0,c,!0)}}]).directive("travelDatePicker",function(){return{restrict:"EA",templateUrl:"pages/drt/travel-date-picker.html",replace:!0}}).controller("travelDatePickerController",["$scope",function(a){function b(a,b){var c=new Date(a),d=new Date(b);return c.getFullYear()===d.getFullYear()&&c.getMonth()==d.getMonth()&&c.getDate()==d.getDate()}function c(a){var a=new Date(a);return a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),a.getTime()}function d(a,b){var c=new Date(a,b-1,1),d=new Date(a,b,0),e=c.getDay()+d.getDate();return Math.ceil(e/7)}function e(a,b){var c=new Date(a);return c.setTime(a+24*b*60*60*1e3),c.getTime()}function f(a){switch(a.getMonth()+1){case 1:h(a.getFullYear())?a.setTime(e(a.getTime(),29)):a.setTime(e(a.getTime(),28));break;case 3:case 5:case 8:case 10:a.setTime(e(a.getTime(),30));break;case 12:case 2:case 4:case 6:case 7:case 9:case 11:a.setTime(e(a.getTime(),31))}}function g(a){a=new Date(a);var b=a.getFullYear(),c=a.getMonth()+1;return 12*(b-1970)+c}function h(a){return a%4==0&&(a%400==0||a%100!=0)}var i=this;i.init=function(a,b,c,h,j){i.st=c?c:(new Date).getTime(),i.et=h?h:i.st+158112e5,i.checkin=a,i.checkout=b,i.dates=[],i.callback=j;for(var k=g(i.et)-g(i.st)+1,c=new Date(i.st),l=0;l<k;l++){i.dates[l]={},i.dates[l].month=c.getTime(),i.dates[l].weeks=[];for(var m=new Date(c.getFullYear(),c.getMonth()+1,0),n=m.getFullYear(),o=m.getMonth()+1,p=d(n,o),q=new Date(c.getFullYear(),c.getMonth(),1),r=q.getDay(),s=0;s<p;s++){i.dates[l].weeks[s]=[];for(var t=0;t<7;t++)r>0?(i.dates[l].weeks[s][t]=null,r--):q>m?i.dates[l].weeks[s][t]=null:(i.dates[l].weeks[s][t]=q.getTime(),q.setTime(new Date(e(q.getTime(),1)).getTime()))}f(c)}},i.clickDate=function(a){return!(i.dDisable(a)||b(a,i.checkin)||b(a,i.checkout))&&void(i.checkin&&i.checkout?(i.checkin=a,i.checkout=null):i.checkin&&!i.checkout?a<i.checkin?i.checkin=a:(i.checkout=a,i.callback(i.checkin,i.checkout)):i.checkin=a)},i.dDisable=function(a){var b=(new Date).getTime();return c(b)>c(a)||c(a)<c(i.st)||c(a)>c(i.et)},i.isCheckin=function(a){return!(!i.checkin||!b(i.checkin,a))},i.isCheckout=function(a){return!(!i.checkout||!b(i.checkout,a))}}])}(),function(){angular.module("app.services",[]).service("backendUrl",["BACKEND_CONFIG",function(a){return function(b,c){return a.test?"server"==c?a.serverUrl+b:a.testUrl+b+a.testExtesion:a.serverUrl+b}}]).service("loadingService",["$ionicLoading",function(a){return function(b){var c=0,d=0;for(var e in b)++c,1==b[e]&&++d;c==d?a.hide():a.show({template:"Loading..."})}}])}(),function(){angular.module("app.filters",[]).filter("ajaxMethod",["BACKEND_CONFIG",function(a){return function(){var b=a.test?"GET":"POST";return b}}])}();