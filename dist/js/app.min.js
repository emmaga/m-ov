/*! m-ov | cc | ISC */
"use strict";String.prototype.parseQuerystring=function(){var a={},b=this.split("&");for(var c in b){var d=b[c].split("=");a[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return a},function(){angular.module("m-ov",["ionic","ui.router","app.filters","app.controllers","app.directive","app.services","pascalprecht.translate"]).config(["$translateProvider",function(a){var b="zh-CN"==navigator.language?navigator.language:"en-US";a.preferredLanguage(b),a.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/index"),a.state("index",{url:"/index",templateUrl:"pages/bookHotelList.html"}).state("bookRoomList",{url:"/bookRoomList",views:{"":{templateUrl:"pages/bookRoomList.html"}}}).state("bookHotelList",{url:"/bookHotelList:?sDate&eDate",views:{"":{templateUrl:"pages/bookHotelList.html"}}}).state("hotelInfo",{url:"/hotelInfo",views:{"":{templateUrl:"pages/hotelInfo.html"}}}).state("bookInfo",{url:"/bookInfo",views:{"":{templateUrl:"pages/bookInfo.html"}}}).state("bookResult",{url:"/bookResult",views:{"":{templateUrl:"pages/bookResult.html"}}}).state("bookRoomSoldOut",{url:"/bookRoomSoldOut",views:{"":{templateUrl:"pages/bookRoomSoldOut.html"}}}).state("memberHome",{url:"/memberHome",views:{"":{templateUrl:"pages/memberHome.html"}}}).state("memberLogin",{url:"/memberLogin",views:{"":{templateUrl:"pages/memberLogin.html"}}}).state("memberRegister",{url:"/memberRegister",views:{"":{templateUrl:"pages/memberRegister.html"}}}).state("memberInfoEdit",{url:"/memberInfoEdit",views:{"":{templateUrl:"pages/memberInfoEdit.html"}}}).state("memberResetPW",{url:"/memberResetPW",views:{"":{templateUrl:"pages/memberResetPW.html"}}}).state("memberOrderList",{url:"/memberOrderList",views:{"":{templateUrl:"pages/memberOrderList.html"}}})}]).constant("BACKEND_CONFIG",{serverUrl:"http://openvod.cleartv.cn/backend_wx/v1/",testUrl:"api/",testExtesion:".json",test:!0})}(),function(){angular.module("app.controllers",["ngCookies"]).controller("RootController",["$scope","$window","$http","$filter","$ionicModal","backendUrl",function(a,b,c,d,e,f){var g=this;g.params={},g.init=function(){var a=b.location.search.substring(1),c=a.parseQuerystring(),d=c.code,e=c.appid;g.setParams("appid",e),g.getUserID(d,e),g.wxConfigJSSDK()},g.setParams=function(a,b){g.params[a]=b},g.getParams=function(a){return g.params[a]},g.getUserID=function(a,b){var e={appid:b,code:a};e=JSON.stringify(e),c.post(f("buildsession","server"),e).success(function(a,b,c,e){"200"==a.rescode?g.getWxUserInfo(access_token,a.openid):alert(d("translate")("serverError")+a.rescode)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},g.getWxUserInfo=function(a,b){var e={access_token:a,openid:b,lang:"zh_CN"};e=JSON.stringify(e),c.get("https://api.weixin.qq.com/sns/userinfo",e).success(function(a,b,c,d){g.setParams("wxUserInfo",a)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},g.wxConfigJSSDK=function(){g.noncestr=Math.random().toString(36).substr(2),g.timestamp=(new Date).getTime()+"";var a={appid:g.getParams("appid"),noncestr:g.noncestr,timestamp:g.timestamp,url:window.location.origin+window.location.pathname+window.location.search};a=JSON.stringify(a),c.post(f("jssign","server"),a).success(function(a,b,c,e){"200"==a.rescode?wx.config({debug:!1,appId:g.getParams("appid"),timestamp:g.timestamp,nonceStr:g.noncestr,signature:a.signature,jsApiList:["getLocation"]}):alert(d("translate")("serverError")+a.rescode)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},e.fromTemplateUrl("pages/mainMenu.html",{scope:a,animation:"slide-in-left"}).then(function(b){a.modal=b}),g.showMainMenu=function(){a.modal.show()}}]).controller("bookHotelListController",["$scope","$location","$http","$stateParams","backendUrl",function(a,b,c,d,e){var f=this;console.log(d.sDate+", "+d.eDate),f.init=function(){f.datePickerShow=!1,f.hotels={},f.checkin=(new Date).getTime(),f.checkout=(new Date).getTime()+864e5,f.search()},f.showDP=function(a){f.datePickerShow=!!a&&a},f.showCP=function(a){f.cityPickerShow=!!a&&a},f.doAfterPickerDates=function(a,b){f.checkin=a,f.checkout=b,f.showDP(!1)},f.search=function(){c.post(e("hotels")).success(function(a,b,c,d){f.hotels=a}).error(function(a,b,c,d){alert(b)})}}]).controller("bookRoomListController",["$http",function(a){var b=this;b.init=function(){}}]).controller("hotelInfoController",["$http",function(a){var b=this;b.init=function(){}}]).controller("bookInfoController",["$http",function(a){var b=this;b.init=function(){}}]).controller("bookResultController",["$http",function(a){var b=this;b.init=function(){}}]).controller("bookRoomSoldOutController",["$http",function(a){var b=this;b.init=function(){}}]).controller("memberHomeController",["$http",function(a){var b=this;b.init=function(){}}]).controller("memberLoginController",["$http",function(a){var b=this;b.init=function(){}}]).controller("memberRegisterController",["$http",function(a){var b=this;b.init=function(){}}]).controller("memberInfoEditController",["$http",function(a){var b=this;b.init=function(){}}]).controller("memberResetPWController",["$http",function(a){var b=this;b.init=function(){}}]).controller("memberOrderListController",["$scope",function(a){var b=this;b.init=function(){}}])}(),function(){angular.module("app.directive",[]).directive("cityPicker",function(){return{restrict:"EA",templateUrl:"pages/drt/city-picker.html",replace:!0}}).controller("cityPickerController",["$scope","$ionicScrollDelegate",function(a,b){var c=this;c.init=function(a){c.callback=a},c.goto=function(a){var c=document.getElementById(a).offsetTop;b.$getByHandle("cityList").scrollTo(0,c,!0)}}]).directive("travelDatePicker",function(){return{restrict:"EA",templateUrl:"pages/drt/travel-date-picker.html",replace:!0}}).controller("travelDatePickerController",["$scope",function(a){function b(a,b){var c=new Date(a),d=new Date(b);return c.getFullYear()===d.getFullYear()&&c.getMonth()==d.getMonth()&&c.getDate()==d.getDate()}function c(a){var a=new Date(a);return a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),a.getTime()}function d(a,b){var c=new Date(a,b-1,1),d=new Date(a,b,0),e=c.getDay()+d.getDate();return Math.ceil(e/7)}function e(a,b){var c=new Date(a);return c.setTime(a+24*b*60*60*1e3),c.getTime()}function f(a){switch(a.getMonth()+1){case 1:h(a.getFullYear())?a.setTime(e(a.getTime(),29)):a.setTime(e(a.getTime(),28));break;case 3:case 5:case 8:case 10:a.setTime(e(a.getTime(),30));break;case 12:case 2:case 4:case 6:case 7:case 9:case 11:a.setTime(e(a.getTime(),31))}}function g(a){a=new Date(a);var b=a.getFullYear(),c=a.getMonth()+1;return 12*(b-1970)+c}function h(a){return a%4==0&&(a%400==0||a%100!=0)}var i=this;i.init=function(a,b,c,h,j){i.st=c?c:(new Date).getTime(),i.et=h?h:i.st+158112e5,i.checkin=a,i.checkout=b,i.dates=[],i.callback=j;for(var k=g(i.et)-g(i.st)+1,c=new Date(i.st),l=0;l<k;l++){i.dates[l]={},i.dates[l].month=c.getTime(),i.dates[l].weeks=[];for(var m=new Date(c.getFullYear(),c.getMonth()+1,0),n=m.getFullYear(),o=m.getMonth()+1,p=d(n,o),q=new Date(c.getFullYear(),c.getMonth(),1),r=q.getDay(),s=0;s<p;s++){i.dates[l].weeks[s]=[];for(var t=0;t<7;t++)r>0?(i.dates[l].weeks[s][t]=null,r--):q>m?i.dates[l].weeks[s][t]=null:(i.dates[l].weeks[s][t]=q.getTime(),q.setTime(new Date(e(q.getTime(),1)).getTime()))}f(c)}},i.clickDate=function(a){return!(i.dDisable(a)||b(a,i.checkin)||b(a,i.checkout))&&void(i.checkin&&i.checkout?(i.checkin=a,i.checkout=null):i.checkin&&!i.checkout?a<i.checkin?i.checkin=a:(i.checkout=a,i.callback(i.checkin,i.checkout)):i.checkin=a)},i.dDisable=function(a){var b=(new Date).getTime();return c(b)>c(a)||c(a)<c(i.st)||c(a)>c(i.et)},i.isCheckin=function(a){return!(!i.checkin||!b(i.checkin,a))},i.isCheckout=function(a){return!(!i.checkout||!b(i.checkout,a))}}])}(),function(){angular.module("app.services",[]).service("backendUrl",["BACKEND_CONFIG",function(a){return function(b,c){return a.test?"server"==c?a.serverUrl+b:a.testUrl+b+a.testExtesion:a.serverUrl+b}}])}(),function(){angular.module("app.filters",[]).filter("xx",["",function(){return function(a){return a}}])}();