/*! m-ov | cc | ISC */
"use strict";String.prototype.parseQuerystring=function(){var a={},b=this.split("&");for(var c in b){var d=b[c].split("=");a[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return a},function(){angular.module("m-ov",["ionic","ui.router","app.filters","app.controllers","app.directive","app.services","pascalprecht.translate"]).config(["$translateProvider",function(a){var b=navigator.language.indexOf("zh")>-1?"zh-CN":"en-US";a.preferredLanguage(b),a.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/index"),a.state("index",{url:"/index",templateUrl:"pages/bookHotelList.html"}).state("bookRoomList",{url:"/bookRoomList/?hotelId&checkIn&checkOut",views:{"":{templateUrl:"pages/bookRoomList.html"}}}).state("hotelInfo",{url:"/hotelInfo/?hotelId",views:{"":{templateUrl:"pages/hotelInfo.html"}}}).state("bookHotelList",{url:"/bookHotelList:?sDate&eDate",views:{"":{templateUrl:"pages/bookHotelList.html"}}}).state("roomInfo",{url:"/roomInfo/?roomId&hotelId&checkIn&checkOut",views:{"":{templateUrl:"pages/roomInfo.html"}}}).state("orderInfo",{url:"/orderInfo",views:{"":{templateUrl:"pages/orderInfo.html"}}}).state("bookRoomSoldOut",{url:"/bookRoomSoldOut",views:{"":{templateUrl:"pages/bookRoomSoldOut.html"}}}).state("memberHome",{url:"/memberHome",views:{"":{templateUrl:"pages/memberHome.html"}}}).state("memberInfoEdit",{url:"/memberInfoEdit/?memberId",views:{"":{templateUrl:"pages/memberInfoEdit.html"}}}).state("memberOrderList",{url:"/memberOrderList",views:{"":{templateUrl:"pages/memberOrderList.html"}}})}]).constant("BACKEND_CONFIG",{serverUrl:"http://openvod.cleartv.cn/backend_wx/v1/",testUrl:"api/",testExtesion:".json",test:!0,mapUrl:"http://openvod.cleartv.cn/map/baidumap.html"})}(),function(){angular.module("app.controllers",["ngCookies"]).controller("RootController",["$scope","$window","$http","$filter","$ionicModal","$translate","backendUrl",function(a,b,c,d,e,f,g){var h=this;h.params={},h.init=function(){var a=b.location.search.substring(1),c=a.parseQuerystring(),d=c.code,e=c.appid;h.setParams("appid",e),h.getUserID(d,e),h.wxConfigJSSDK(),h.wxShare=function(){setTimeout(function(){wx.onMenuShareAppMessage({title:"",desc:"",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+h.getParams("appid")+"&redirect_uri="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)+"&response_type=code&scope=snsapi_userinfo&state=&component_appid=wx5bfdc86d4b702418#wechat_redirect",imgUrl:"",type:"",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+h.getParams("appid")+"&redirect_uri="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)+"&response_type=code&scope=snsapi_userinfo&state=&component_appid=wx5bfdc86d4b702418#wechat_redirect",imgUrl:"",success:function(){},cancel:function(){}})},1e3)}},h.setParams=function(a,b){h.params[a]=b},h.getParams=function(a){return h.params[a]},h.getUserID=function(a,b){var e={appid:b,code:a};e=JSON.stringify(e),c.post(g("buildsession","","server"),e).success(function(a,b,c,d){h.getWxUserInfo(a.access_token,a.openid)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},h.getWxUserInfo=function(a,b){var e=f.proposedLanguage()||f.use();e="zh-CN"==e?"zh_CN":"en";var i={access_token:a,openid:b,lang:e};i=JSON.stringify(i),c.post(g("wxuserinfo","","server"),i).success(function(a,b,c,d){h.setParams("wxUserInfo",a)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},h.wxConfigJSSDK=function(){h.noncestr=Math.random().toString(36).substr(2),h.timestamp=(new Date).getTime()+"";var a={appid:h.getParams("appid"),noncestr:h.noncestr,timestamp:h.timestamp,url:window.location.origin+window.location.pathname+window.location.search};a=JSON.stringify(a),c.post(g("jssign","","server"),a).success(function(a,b,c,e){"200"==a.rescode?wx.config({debug:!0,appId:h.getParams("appid"),timestamp:h.timestamp,nonceStr:h.noncestr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","chooseWXPay"]}):alert(d("translate")("serverError")+a.rescode)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},e.fromTemplateUrl("pages/mainMenu.html",{scope:a,animation:"slide-in-left"}).then(function(b){a.modal=b}),h.showMainMenu=function(){a.modal.show()}}]).controller("bookHotelListController",["$scope","$filter","$timeout","$location","$http","$stateParams","loadingService","backendUrl","util",function(a,b,c,d,e,f,g,h,i){var j=this;j.init=function(){a.root.wxShare(),j.showLoadingBool={},j.showLoadingBool.searchProjectInfoBool=!1,j.showLoadingBool.searchCityListsBool=!1,j.showLoadingBool.searchHotelListBool=!1,g(j.showLoadingBool),j.datePickerShow=!1,j.hotels={},j.checkin=(new Date).getTime(),j.checkout=j.checkin+864e5,j.stayDays=i.countDay(j.checkin,j.checkout),j.cityInfo={id:"0",name:"全部"},j.searchProjectInfo(),j.searchHotelList(),j.searchCityLists()},j.showDP=function(a){j.datePickerShow=!!a&&a},j.showCP=function(a){j.cityPickerShow=!!a&&a},j.doAfterPickDates=function(a,b){j.checkin=a,j.checkout=b,j.stayDays=i.countDay(j.checkin,j.checkout),c(function(){j.showDP(!1)},500)},j.doAfterPickCity=function(a,b){j.cityInfo={id:a,name:b},j.showCP(!1)},console.log(h("project","projectInfo")),console.log(h("project","cityLists")),j.searchProjectInfo=function(){e({method:b("ajaxMethod")(),url:h("project","projectInfo")}).then(function(a,b,c,d){console.log(a),j.projectInfo=a.data.data,j.showLoadingBool.searchProjectInfoBool=!0,g(j.showLoadingBool)},function(a,b,c,d){j.showLoadingBool.searchProjectInfoBool=!0,g(j.showLoadingBool),alert(b)})},j.searchCityLists=function(){e({method:b("ajaxMethod")(),url:h("project","cityLists")}).then(function(a,b,c,d){j.cityLists=a.data.data.cityLists,j.showLoadingBool.searchCityListsBool=!0,g(j.showLoadingBool)},function(a,b,c,d){j.showLoadingBool.searchCityListsBool=!0,g(j.showLoadingBool),alert(b)})},j.searchHotelList=function(){e({method:b("ajaxMethod")(),url:h("bookHotel","hotelList")}).then(function(a,b,c,d){j.hotels=a.data.data.hotelLists,j.hotelNum=a.data.data.hotelNum,j.showLoadingBool.searchHotelListBool=!0,g(j.showLoadingBool)},function(a,b,c,d){j.showLoadingBool.searchHotelListBool=!0,g(j.showLoadingBool),alert(b)})}}]).controller("bookRoomListController",["$scope","$http","$filter","$stateParams","$timeout","loadingService","backendUrl","BACKEND_CONFIG","util",function(a,b,c,d,e,f,g,h,i){console.log("bookRoomListController");var j=this;console.log(i.countDay(1,2)),j.init=function(){a.root.wxShare(),j.hotelId=d.hotelId,j.checkIn=d.checkIn-0,j.checkOut=d.checkOut-0,j.stayDays=i.countDay(j.checkIn,j.checkOut),j.showLoadingBool={},j.showLoadingBool.searchHotelInfoBool=!1,j.showLoadingBool.searchRoomListBool=!1,f(j.showLoadingBool),j.searchHotelInfo(),j.searchRoomList()},j.showDP=function(a){j.datePickerShow=!!a&&a},j.doAfterPickDates=function(a,b){j.checkIn=a,j.checkOut=b,j.stayDays=i.countDay(j.checkIn,j.checkOut),e(function(){j.showDP(!1)},500)},j.searchHotelInfo=function(){e(function(){b({method:c("ajaxMethod")(),url:g("bookHotel","hotelInfo")}).then(function(a,b,c,d){j.hotel=a.data.data.hotel,j.showLoadingBool.searchHotelInfoBool=!0,j.locationHref=h.mapUrl+"?x="+j.hotel.hotelLocation.X+"&y="+j.hotel.hotelLocation.Y,f(j.showLoadingBool),console.log("searchHotelInfoBool")},function(a,b,c,d){j.showLoadingBool.searchHotelInfoBool=!0,f(j.showLoadingBool),alert(b)})},300)},j.searchRoomList=function(){b({method:c("ajaxMethod")(),url:g("bookHotel","roomList")}).then(function(a,b,c,d){j.rooms=a.data.data,j.showLoadingBool.searchRoomListBool=!0,f(j.showLoadingBool)},function(a,b,c,d){j.showLoadingBool.searchHotelInfoBool=!0,f(j.showLoadingBool),alert(b)})}}]).controller("hotelInfoController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("roomInfoController",["$scope","$http","$filter","$stateParams","$timeout","loadingService","backendUrl","util",function(a,b,c,d,e,f,g,h){console.log("roomInfoController"),console.log(d);var i=this;i.init=function(){a.root.wxShare(),i.showLoadingBool={},i.showLoadingBool.searchBool=!1,f(i.showLoadingBool),i.checkIn=d.checkIn-0,i.checkOut=d.checkOut-0,i.roomId=d.roomId,i.stayDays=h.countDay(i.checkIn,i.checkOut),i.search()},i.search=function(){e(function(){b({method:c("ajaxMethod")(),url:g("bookHotel","roomInfo")}).then(function(a,b,c,d){console.log(a),i.room=a.data.data.room,console.log(i.room),i.showLoadingBool.searchBool=!0,f(i.showLoadingBool)},function(a,b,c,d){i.showLoadingBool.searchBool=!0,f(i.showLoadingBool),alert(b)})},500)},i.getAuthCode=function(){b({method:c("ajaxMethod")(),url:g("authCode")}).then(function(a,b,c,d){console.log(a)},function(a,b,c,d){alert(b)})},i.newOrder=function(){var a={wxappid:i.getParams("appid"),openid:i.getParams("wxUserInfo").openid,orderType:"Room",goodsID:i.roomId,goodsName:"清鹤酒店连锁",goodsDetail:i.room.roomName,goodsExtraInfo:"钻石会员",goodsPrice:1,clientIP:"1.1.1.1"};a=JSON.stringify(a),b.post(g("neworder","server"),a).success(function(a,b,d,e){"200"==a.rescode?i.wxPay(a.nonceStr,a.sign,a.prepay_id):alert(c("translate")("serverError")+" "+a.rescode+" "+a.errInfo)}).error(function(a,b,d,e){alert(c("translate")("serverError")+b)})},i.wxPay=function(a,b,c){wx.chooseWXPay({timestamp:new Date.getTime,nonceStr:a,package:"prepay_id="+c,signType:"MD5",paySign:b,success:function(a){}})}}]).controller("orderInfoController",["$scope","$http","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e,f){console.log("bookInfoController");var g=this;g.init=function(){a.root.wxShare(),g.showLoadingBool={},g.showLoadingBool.searchBool=!1,e(g.showLoadingBool),g.search()},g.search=function(){b({method:c("ajaxMethod")(),url:f("order","orderInfo")}).then(function(a,b,c,d){g.room=a.data.data.room,g.hotel=a.data.data.hotel,g.roomOrder=a.data.data.roomOrder,g.showLoadingBool.searchBool=!0,e(g.showLoadingBool)},function(a,b,c,d){g.showLoadingBool.searchBool=!0,e(g.showLoadingBool),alert(b)})}}]).controller("bookRoomSoldOutController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberHomeController",["$http","$scope","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e,f){console.log("memberHomeController");var g=this;g.init=function(){b.root.wxShare(),g.showLoadingBool={},g.showLoadingBool.searchBool=!1,e(g.showLoadingBool.searchBool),g.search()},g.search=function(){a({method:c("ajaxMethod")(),url:f("member","memberInfo")}).then(function(a,b,c,d){console.log(a),g.member=a.data.data.member,console.log(g.member),g.showLoadingBool.searchBool=!0,e(g.showLoadingBool.searchBool)},function(a,b,c,d){g.showLoadingBool.searchBool=!0,e(g.showLoadingBool.searchBool),alert(b)})}}]).controller("memberInfoEditController",["$http","$scope","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e,f){console.log("memberInfoEditController");var g=this;g.memberId=d.memberId,g.init=function(){b.root.wxShare(),g.showLoadingBool={},g.showLoadingBool.searchBool=!1,e(g.showLoadingBool),g.search()},g.search=function(){a({method:c("ajaxMethod")(),url:f("member","memberInfo"),data:{hotelId:d.hotelId,roomId:d.roomId}}).then(function(a,b,c,d){console.log(a),g.member=a.data.data.member,console.log(g.member),g.showLoadingBool.searchBool=!0,e(g.showLoadingBool)},function(a,b,c,d){g.showLoadingBool.searchBool=!0,e(g.showLoadingBool),alert(b)})},g.getAuthCode=function(){a({method:c("ajaxMethod")(),url:f("authCode")}).then(function(a,b,c,d){console.log(a)},function(a,b,c,d){alert(b)})}}]).controller("memberOrderListController",["$http","$scope","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e,f){var g=this;g.init=function(){b.root.wxShare(),g.showLoadingBool={},g.showLoadingBool.searchBool=!1,e(g.showLoadingBool),g.search()},g.search=function(){a({method:c("ajaxMethod")(),url:f("member","orderList")}).then(function(a,b,c,d){console.log(a),g.orderLists=a.data.data.orderLists,g.showLoadingBool.searchBool=!0,e(g.showLoadingBool)},function(a,b,c,d){g.showLoadingBool.searchBool=!0,e(g.showLoadingBool),alert(b)})}}])}(),function(){angular.module("app.directive",[]).directive("cityPicker",function(){return{restrict:"EA",templateUrl:"pages/drt/city-picker.html",replace:!0}}).controller("cityPickerController",["$scope","$ionicScrollDelegate",function(a,b){var c=this;c.init=function(a,b){c.callback=b,c.cityLists=a},c.scrollTo=function(a){var c=document.getElementById(a).offsetTop;b.$getByHandle("cityList").scrollTo(0,c,!0)}}]).directive("travelDatePicker",function(){return{restrict:"EA",templateUrl:"pages/drt/travel-date-picker.html",replace:!0}}).controller("travelDatePickerController",["$scope","$filter",function(a,b){function c(a,b){var c=new Date(a),d=new Date(b);return c.getFullYear()===d.getFullYear()&&c.getMonth()==d.getMonth()&&c.getDate()==d.getDate()}function d(a){var a=new Date(a);return a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),a.getTime()}function e(a,b){var c=new Date(a,b-1,1),d=new Date(a,b,0),e=c.getDay()+d.getDate();return Math.ceil(e/7)}function f(a,b){var c=new Date(a);return c.setTime(a+24*b*60*60*1e3),c.getTime()}function g(a){switch(a.getMonth()+1){case 1:i(a.getFullYear())?a.setTime(f(a.getTime(),29)):a.setTime(f(a.getTime(),28));break;case 3:case 5:case 8:case 10:a.setTime(f(a.getTime(),30));break;case 12:case 2:case 4:case 6:case 7:case 9:case 11:a.setTime(f(a.getTime(),31))}}function h(a){a=new Date(a);var b=a.getFullYear(),c=a.getMonth()+1;return 12*(b-1970)+c}function i(a){return a%4==0&&(a%400==0||a%100!=0)}var j=this;j.init=function(a,c,d,e,f){var g=document.createElement("style");g.innerText=".tdp-d-checkin:after{content:'"+b("translate")("checkIn")+"'}",g.innerText+=".tdp-d-checkout:after{content:'"+b("translate")("checkOut")+"'}",document.body.appendChild(g),j.st=d?d:(new Date).getTime(),j.et=e?e:j.st+158112e5,j.checkin=a,j.checkout=c,j.dates=[],j.callback=f,j.setDateData(),j.msgShow=!0,j.msg=b("translate")("plsSelACheckInDate")},j.setDateData=function(){for(var a=h(j.et)-h(j.st)+1,b=new Date(j.st),c=0;c<a;c++){j.dates[c]={},j.dates[c].month=b.getTime(),j.dates[c].weeks=[];for(var d=new Date(b.getFullYear(),b.getMonth()+1,0),i=d.getFullYear(),k=d.getMonth()+1,l=e(i,k),m=new Date(b.getFullYear(),b.getMonth(),1),n=m.getDay(),o=0;o<l;o++){j.dates[c].weeks[o]=[];for(var p=0;p<7;p++)n>0?(j.dates[c].weeks[o][p]=null,n--):m>d?j.dates[c].weeks[o][p]=null:(j.dates[c].weeks[o][p]=m.getTime(),m.setTime(new Date(f(m.getTime(),1)).getTime()))}g(b)}},j.clickDate=function(a){return!j.dDisable(a)&&void(j.checkin&&j.checkout?(j.checkin=a,j.checkout=null,j.msgShow=!0,j.msg=b("translate")("plsSelACheckOutDate")):j.checkin&&!j.checkout?a<j.checkin?j.checkin=a:(j.checkout=a,j.msgShow=!1,j.msg="",j.callback(j.checkin,j.checkout)):j.checkin=a)},j.dDisable=function(a){var b=(new Date).getTime();return d(b)>d(a)||d(a)<d(j.st)||d(a)>d(j.et)},j.isDuring=function(a){var b=!1;return j.checkin&&j.checkout&&a>j.checkin&&a<j.checkout&&(b=!0),b},j.isCheckin=function(a){return!(!j.checkin||!c(j.checkin,a))},j.isCheckout=function(a){return!(!j.checkout||!c(j.checkout,a))}}])}(),function(){angular.module("app.services",[]).service("backendUrl",["BACKEND_CONFIG",function(a){return function(b,c,d){return a.test?"server"==d?a.serverUrl+b:a.testUrl+c+a.testExtesion:a.serverUrl+b}}]).service("loadingService",["$ionicLoading",function(a){return function(b){var c=0,d=0;for(var e in b)++c,1==b[e]&&++d;c==d?a.hide():a.show({template:"Loading..."})}}]).factory("util",function(){function a(a){var a=new Date(a);return a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),a.getTime()}return{countDay:function(b,c){return(a(c)-a(b))/864e5}}})}(),function(){angular.module("app.filters",[]).filter("ajaxMethod",["BACKEND_CONFIG",function(a){return function(){var b=a.test?"GET":"POST";return b}}])}();