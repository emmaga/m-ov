/*! m-ov | cc | ISC */
"use strict";String.prototype.parseQuerystring=function(){var a={},b=this.split("&");for(var c in b){var d=b[c].split("=");a[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return a},function(){angular.module("m-ov",["ionic","ui.router","app.filters","app.controllers","app.directive","app.services","pascalprecht.translate"]).config(["$translateProvider",function(a){var b=navigator.language.indexOf("zh")>-1?"zh-CN":"en-US";a.preferredLanguage(b),a.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/index"),a.state("index",{url:"/index",templateUrl:"pages/bookHotelList.html"}).state("bookRoomList",{url:"/bookRoomList/?hotelId&checkIn&checkOut",views:{"":{templateUrl:"pages/bookRoomList.html"}}}).state("hotelInfo",{url:"/hotelInfo/?hotelId",views:{"":{templateUrl:"pages/hotelInfo.html"}}}).state("bookHotelList",{url:"/bookHotelList",views:{"":{templateUrl:"pages/bookHotelList.html"}}}).state("roomInfo",{url:"/roomInfo/?roomId&hotelId&checkIn&checkOut",views:{"":{templateUrl:"pages/roomInfo.html"}}}).state("orderInfo",{url:"/orderInfo/?orderId",views:{"":{templateUrl:"pages/orderInfo.html"}}}).state("bookRoomSoldOut",{url:"/bookRoomSoldOut",views:{"":{templateUrl:"pages/bookRoomSoldOut.html"}}}).state("memberHome",{url:"/memberHome",views:{"":{templateUrl:"pages/memberHome.html"}}}).state("memberInfoEdit",{url:"/memberInfoEdit/?memberId",views:{"":{templateUrl:"pages/memberInfoEdit.html"}}}).state("memberOrderList",{url:"/memberOrderList",views:{"":{templateUrl:"pages/memberOrderList.html"}}})}]).constant("BACKEND_CONFIG",{serverUrl:"http://openvod.cleartv.cn/backend_wx/v1/",testUrl:"api/",testExtesion:".json",test:!0,mapUrl:"http://openvod.cleartv.cn/map/baidumap.html"})}(),function(){angular.module("app.controllers",["ngCookies"]).controller("RootController",["$scope","$window","$http","$filter","$ionicModal","$translate","backendUrl",function(a,b,c,d,e,f,g){var h=this;h.params={},h.init=function(){var a=b.location.search.substring(1),c=a.parseQuerystring(),d=c.code,e=c.appid;h.setParams("appid",e),h.getUserID(d,e),h.wxConfigJSSDK(),h.wxShare=function(){setTimeout(function(){wx.onMenuShareAppMessage({title:"",desc:"",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+h.getParams("appid")+"&redirect_uri="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)+"&response_type=code&scope=snsapi_userinfo&state=&component_appid=wx5bfdc86d4b702418#wechat_redirect",imgUrl:"",type:"",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+h.getParams("appid")+"&redirect_uri="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)+"&response_type=code&scope=snsapi_userinfo&state=&component_appid=wx5bfdc86d4b702418#wechat_redirect",imgUrl:"",success:function(){},cancel:function(){}})},1e3)},h.searchProjectInfo()},h.setParams=function(a,b){h.params[a]=b},h.getParams=function(a){return h.params[a]},h.getUserID=function(a,b){var e={appid:b,code:a};e=JSON.stringify(e),c.post(g("buildsession","","server"),e).success(function(a,b,c,d){h.getWxUserInfo(a.access_token,a.openid)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},h.getWxUserInfo=function(a,b){var e=f.proposedLanguage()||f.use();e="zh-CN"==e?"zh_CN":"en";var i={access_token:a,openid:b,lang:e};i=JSON.stringify(i),c.post(g("wxuserinfo","","server"),i).success(function(a,b,c,d){h.setParams("wxUserInfo",a)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},h.wxConfigJSSDK=function(){h.noncestr=Math.random().toString(36).substr(2),h.timestamp=(new Date).getTime()+"";var a={appid:h.getParams("appid"),noncestr:h.noncestr,timestamp:h.timestamp,url:window.location.origin+window.location.pathname+window.location.search};a=JSON.stringify(a),c.post(g("jssign","","server"),a).success(function(a,b,c,e){"200"==a.rescode?wx.config({debug:!0,appId:h.getParams("appid"),timestamp:h.timestamp,nonceStr:h.noncestr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","chooseWXPay"]}):alert(d("translate")("serverError")+a.rescode)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},h.searchProjectInfo=function(){c({method:d("ajaxMethod")(),url:g("project","projectInfo")}).then(function(a,b,c,d){console.log(a),h.projectInfo=a.data.data,h.setParams("projectInfo",h.projectInfo)},function(a,b,c,d){alert(b)})},e.fromTemplateUrl("pages/mainMenu.html",{scope:a,animation:"slide-in-left"}).then(function(b){a.modal=b}),h.showMainMenu=function(){a.modal.show()}}]).controller("bookHotelListController",["$scope","$filter","$timeout","$location","$http","$stateParams","$ionicPopup","loadingService","backendUrl","util",function(a,b,c,d,e,f,g,h,i,j){var k=this;k.init=function(){a.root.wxShare(),k.showLoadingBool={},k.showLoadingBool.searchCityListsBool=!1,k.showLoadingBool.searchHotelListBool=!1,h(k.showLoadingBool),k.datePickerShow=!1,k.hotels={},k.checkin=(new Date).getTime(),k.checkout=k.checkin+864e5,k.stayDays=j.countDay(k.checkin,k.checkout),k.cityInfo={id:"0",name:"全部"},k.searchHotelList(),k.searchCityLists()},k.showDP=function(a){k.datePickerShow=!!a&&a},k.showCP=function(a){k.cityPickerShow=!!a&&a},k.doAfterPickDates=function(a,b){k.checkin=a,k.checkout=b,k.stayDays=j.countDay(k.checkin,k.checkout),c(function(){k.showDP(!1)},500)},k.doAfterPickCity=function(a,b){k.cityInfo={id:a,name:b},k.showCP(!1)},k.searchCityLists=function(){e({method:b("ajaxMethod")(),url:i("project","cityLists")}).then(function(a,b,c,d){k.cityLists=a.data.data.cityLists,k.showLoadingBool.searchCityListsBool=!0,h(k.showLoadingBool)},function(a,b,c,d){k.showLoadingBool.searchCityListsBool=!0,h(k.showLoadingBool),g.alert({template:b})})},k.searchHotelList=function(){e({method:b("ajaxMethod")(),url:i("bookHotel","hotelList")}).then(function(a,b,c,d){k.hotels=a.data.data.hotelLists,k.hotelNum=a.data.data.hotelNum,k.showLoadingBool.searchHotelListBool=!0,h(k.showLoadingBool)},function(a,b,c,d){k.showLoadingBool.searchHotelListBool=!0,h(k.showLoadingBool),g.alert({template:b})})}}]).controller("bookRoomListController",["$scope","$http","$filter","$stateParams","$timeout","$ionicPopup","loadingService","backendUrl","BACKEND_CONFIG","util",function(a,b,c,d,e,f,g,h,i,j){console.log("bookRoomListController");var k=this;console.log(j.countDay(1,2)),k.init=function(){a.root.wxShare(),k.hotelId=d.hotelId,k.checkIn=d.checkIn-0,k.checkOut=d.checkOut-0,k.stayDays=j.countDay(k.checkIn,k.checkOut),k.showLoadingBool={},k.showLoadingBool.searchHotelInfoBool=!1,k.showLoadingBool.searchRoomListBool=!1,g(k.showLoadingBool),k.searchHotelInfo(),k.searchRoomList()},k.showDP=function(a){k.datePickerShow=!!a&&a},k.doAfterPickDates=function(a,b){k.checkIn=a,k.checkOut=b,k.stayDays=j.countDay(k.checkIn,k.checkOut),e(function(){k.showDP(!1)},500)},k.searchHotelInfo=function(){e(function(){b({method:c("ajaxMethod")(),url:h("bookHotel","hotelInfo")}).then(function(a,b,c,d){k.hotel=a.data.data.hotel,k.showLoadingBool.searchHotelInfoBool=!0,k.locationHref=i.mapUrl+"?x="+k.hotel.hotelLocation.X+"&y="+k.hotel.hotelLocation.Y,g(k.showLoadingBool),console.log("searchHotelInfoBool")},function(a,b,c,d){k.showLoadingBool.searchHotelInfoBool=!0,g(k.showLoadingBool),f.alert({template:b})})},300)},k.searchRoomList=function(){b({method:c("ajaxMethod")(),url:h("bookHotel","roomList")}).then(function(a,b,c,d){k.rooms=a.data.data,k.showLoadingBool.searchRoomListBool=!0,g(k.showLoadingBool)},function(a,b,c,d){k.showLoadingBool.searchHotelInfoBool=!0,g(k.showLoadingBool),f.alert({template:b})})}}]).controller("hotelInfoController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("roomInfoController",["$location","$scope","$http","$filter","$state","$stateParams","$timeout","$ionicPopup","loadingService","backendUrl","util",function(a,b,c,d,e,f,g,h,i,j,k){console.log("roomInfoController"),console.log(f);var l=this;l.init=function(){b.root.wxShare(),l.showLoadingBool={},l.showLoadingBool.searchBool=!1,i(l.showLoadingBool),l.checkIn=f.checkIn-0,l.checkOut=f.checkOut-0,l.roomId=f.roomId,l.stayDays=k.countDay(l.checkIn,l.checkOut),l.search()},l.search=function(){g(function(){c({method:d("ajaxMethod")(),url:j("bookHotel","roomInfo")}).then(function(a,b,c,d){l.room=a.data.data.room,l.showLoadingBool.searchBool=!0,i(l.showLoadingBool)},function(a,b,c,d){l.showLoadingBool.searchBool=!0,i(l.showLoadingBool),h.alert({template:b})})},500)},l.getAuthCode=function(){c({method:d("ajaxMethod")(),url:j("authCode")}).then(function(a,b,c,d){console.log(a)},function(a,b,c,d){alert(b)})},l.newOrder=function(){return},l.wxPay=function(a,b,c,d){wx.chooseWXPay({timestamp:new Date.getTime,nonceStr:a,package:"prepay_id="+c,signType:"MD5",paySign:b,success:function(a){e.go("orderInfo",{orderId:d})}})}}]).controller("orderInfoController",["$scope","$http","$filter","$stateParams","$ionicPopup","loadingService","backendUrl",function(a,b,c,d,e,f,g){console.log("bookInfoController");var h=this;h.init=function(){a.root.wxShare(),h.showLoadingBool={},h.showLoadingBool.searchBool=!1,f(h.showLoadingBool),h.search()},h.search=function(){b({method:c("ajaxMethod")(),url:g("order","orderInfo")}).then(function(a,b,c,d){h.room=a.data.data.room,h.hotel=a.data.data.hotel,h.roomOrder=a.data.data.roomOrder,h.showLoadingBool.searchBool=!0,f(h.showLoadingBool)},function(a,b,c,d){h.showLoadingBool.searchBool=!0,f(h.showLoadingBool),e.alert({template:b})})}}]).controller("bookRoomSoldOutController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberHomeController",["$http","$scope","$filter","$stateParams","$ionicPopup","loadingService","backendUrl",function(a,b,c,d,e,f,g){console.log("memberHomeController");var h=this;h.init=function(){b.root.wxShare(),h.showLoadingBool={},h.showLoadingBool.searchBool=!1,f(h.showLoadingBool.searchBool),h.search()},h.search=function(){a({method:c("ajaxMethod")(),url:g("member","memberInfo")}).then(function(a,b,c,d){console.log(a),h.member=a.data.data.member,console.log(h.member),h.showLoadingBool.searchBool=!0,f(h.showLoadingBool.searchBool)},function(a,b,c,d){h.showLoadingBool.searchBool=!0,f(h.showLoadingBool.searchBool),e.alert({template:b})})}}]).controller("memberInfoEditController",["$http","$scope","$filter","$stateParams","$ionicPopup","loadingService","backendUrl",function(a,b,c,d,e,f,g){console.log("memberInfoEditController");var h=this;h.memberId=d.memberId,h.init=function(){b.root.wxShare(),h.showLoadingBool={},h.showLoadingBool.searchBool=!1,f(h.showLoadingBool),h.search()},h.search=function(){a({method:c("ajaxMethod")(),url:g("member","memberInfo"),data:{hotelId:d.hotelId,roomId:d.roomId}}).then(function(a,b,c,d){console.log(a),h.member=a.data.data.member,console.log(h.member),h.showLoadingBool.searchBool=!0,f(h.showLoadingBool)},function(a,b,c,d){h.showLoadingBool.searchBool=!0,f(h.showLoadingBool),e.alert({template:b})})},h.getAuthCode=function(){a({method:c("ajaxMethod")(),url:g("authCode")}).then(function(a,b,c,d){console.log(a)},function(a,b,c,d){alert(b)})}}]).controller("memberOrderListController",["$http","$scope","$filter","$stateParams","$ionicPopup","loadingService","backendUrl",function(a,b,c,d,e,f,g){console.log("memberOrderListController");var h=this;h.init=function(){b.root.wxShare(),h.showLoadingBool={},h.showLoadingBool.searchBool=!1,f(h.showLoadingBool),h.search()},h.search=function(){a({method:c("ajaxMethod")(),url:g("member","orderList")}).then(function(a,b,c,d){console.log(a),h.orderLists=a.data.data.orderLists,h.showLoadingBool.searchBool=!0,f(h.showLoadingBool)},function(a,b,c,d){h.showLoadingBool.searchBool=!0,f(h.showLoadingBool),e.alert({template:b})})}}])}(),function(){angular.module("app.directive",[]).directive("cityPicker",function(){return{restrict:"EA",templateUrl:"pages/drt/city-picker.html",replace:!0}}).controller("cityPickerController",["$scope","$ionicScrollDelegate",function(a,b){var c=this;c.init=function(a,b){c.callback=b,c.cityLists=a},c.scrollTo=function(a){var c=document.getElementById(a).offsetTop;b.$getByHandle("cityList").scrollTo(0,c,!0)}}]).directive("travelDatePicker",function(){return{restrict:"EA",templateUrl:"pages/drt/travel-date-picker.html",replace:!0}}).controller("travelDatePickerController",["$scope","$filter",function(a,b){function c(a,b){var c=new Date(a),d=new Date(b);return c.getFullYear()===d.getFullYear()&&c.getMonth()==d.getMonth()&&c.getDate()==d.getDate()}function d(a){var a=new Date(a);return a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),a.getTime()}function e(a,b){var c=new Date(a,b-1,1),d=new Date(a,b,0),e=c.getDay()+d.getDate();return Math.ceil(e/7)}function f(a,b){var c=new Date(a);return c.setTime(a+24*b*60*60*1e3),c.getTime()}function g(a){switch(a.getMonth()+1){case 1:i(a.getFullYear())?a.setTime(f(a.getTime(),29)):a.setTime(f(a.getTime(),28));break;case 3:case 5:case 8:case 10:a.setTime(f(a.getTime(),30));break;case 12:case 2:case 4:case 6:case 7:case 9:case 11:a.setTime(f(a.getTime(),31))}}function h(a){a=new Date(a);var b=a.getFullYear(),c=a.getMonth()+1;return 12*(b-1970)+c}function i(a){return a%4==0&&(a%400==0||a%100!=0)}var j=this;j.init=function(a,c,d,e,f){var g=document.createElement("style");g.innerText=".tdp-d-checkin:after{content:'"+b("translate")("checkIn")+"'}",g.innerText+=".tdp-d-checkout:after{content:'"+b("translate")("checkOut")+"'}",document.body.appendChild(g),j.st=d?d:(new Date).getTime(),j.et=e?e:j.st+158112e5,j.checkin=a,j.checkout=c,j.dates=[],j.callback=f,j.setDateData(),j.msgShow=!0,j.msg=b("translate")("plsSelACheckInDate")},j.setDateData=function(){for(var a=h(j.et)-h(j.st)+1,b=new Date(j.st),c=0;c<a;c++){j.dates[c]={},j.dates[c].month=b.getTime(),j.dates[c].weeks=[];for(var d=new Date(b.getFullYear(),b.getMonth()+1,0),i=d.getFullYear(),k=d.getMonth()+1,l=e(i,k),m=new Date(b.getFullYear(),b.getMonth(),1),n=m.getDay(),o=0;o<l;o++){j.dates[c].weeks[o]=[];for(var p=0;p<7;p++)n>0?(j.dates[c].weeks[o][p]=null,n--):m>d?j.dates[c].weeks[o][p]=null:(j.dates[c].weeks[o][p]=m.getTime(),m.setTime(new Date(f(m.getTime(),1)).getTime()))}g(b)}},j.clickDate=function(a){return!j.dDisable(a)&&void(j.checkin&&j.checkout?(j.checkin=a,j.checkout=null,j.msgShow=!0,j.msg=b("translate")("plsSelACheckOutDate")):j.checkin&&!j.checkout?a<j.checkin?j.checkin=a:(j.checkout=a,j.msgShow=!1,j.msg="",j.callback(j.checkin,j.checkout)):j.checkin=a)},j.dDisable=function(a){var b=(new Date).getTime();return d(b)>d(a)||d(a)<d(j.st)||d(a)>d(j.et)},j.isDuring=function(a){var b=!1;return j.checkin&&j.checkout&&a>j.checkin&&a<j.checkout&&(b=!0),b},j.isCheckin=function(a){return!(!j.checkin||!c(j.checkin,a))},j.isCheckout=function(a){return!(!j.checkout||!c(j.checkout,a))}}])}(),function(){angular.module("app.services",[]).service("backendUrl",["BACKEND_CONFIG",function(a){return function(b,c,d){return a.test?"server"==d?a.serverUrl+b:a.testUrl+c+a.testExtesion:a.serverUrl+b}}]).service("loadingService",["$ionicLoading",function(a){return function(b){var c=0,d=0;for(var e in b)++c,1==b[e]&&++d;c==d?a.hide():a.show({template:"Loading..."})}}]).factory("util",function(){function a(a){var a=new Date(a);return a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),a.getTime()}return{countDay:function(b,c){return(a(c)-a(b))/864e5}}})}(),function(){angular.module("app.filters",[]).filter("ajaxMethod",["BACKEND_CONFIG",function(a){return function(){var b=a.test?"GET":"POST";return b}}])}();