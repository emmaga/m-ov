/*! m-ov | cc | ISC */
"use strict";String.prototype.parseQuerystring=function(){var a={},b=this.split("&");for(var c in b){var d=b[c].split("=");a[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return a},function(){angular.module("m-ov",["ionic","ui.router","app.filters","app.controllers","app.directive","app.services","pascalprecht.translate"]).config(["$translateProvider",function(a){var b=navigator.language.indexOf("zh")>-1?"zh-CN":"en-US";a.preferredLanguage(b),a.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/index"),a.state("index",{url:"/index",templateUrl:"pages/bookHotelList.html"}).state("bookRoomList",{url:"/bookRoomList/?hotelId&checkIn&checkOut",views:{"":{templateUrl:"pages/bookRoomList.html"}}}).state("hotelInfo",{url:"/hotelInfo/?hotelId",views:{"":{templateUrl:"pages/hotelInfo.html"}}}).state("bookHotelList",{url:"/bookHotelList:?sDate&eDate",views:{"":{templateUrl:"pages/bookHotelList.html"}}}).state("roomInfo",{url:"/roomInfo/?roomId&hotelId&checkIn&checkOut",views:{"":{templateUrl:"pages/roomInfo.html"}}}).state("orderInfo",{url:"/orderInfo",views:{"":{templateUrl:"pages/orderInfo.html"}}}).state("bookRoomSoldOut",{url:"/bookRoomSoldOut",views:{"":{templateUrl:"pages/bookRoomSoldOut.html"}}}).state("memberHome",{url:"/memberHome",views:{"":{templateUrl:"pages/memberHome.html"}}}).state("memberInfoEdit",{url:"/memberInfoEdit/?memberId",views:{"":{templateUrl:"pages/memberInfoEdit.html"}}}).state("memberOrderList",{url:"/memberOrderList",views:{"":{templateUrl:"pages/memberOrderList.html"}}})}]).constant("BACKEND_CONFIG",{serverUrl:"http://openvod.cleartv.cn/backend_wx/v1/",testUrl:"api/",testExtesion:".json",test:!0})}(),function(){angular.module("app.controllers",["ngCookies"]).controller("RootController",["$scope","$window","$http","$filter","$ionicModal","$translate","backendUrl",function(a,b,c,d,e,f,g){var h=this;h.params={},h.init=function(){var a=b.location.search.substring(1),c=a.parseQuerystring(),d=c.code,e=c.appid;h.setParams("appid",e),h.getUserID(d,e),h.wxConfigJSSDK(),h.wxShare=function(){setTimeout(function(){wx.onMenuShareAppMessage({title:"",desc:"",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+h.getParams("appid")+"&redirect_uri="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)+"&response_type=code&scope=snsapi_userinfo&state=&component_appid=wx5bfdc86d4b702418#wechat_redirect",imgUrl:"",type:"",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+h.getParams("appid")+"&redirect_uri="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)+"&response_type=code&scope=snsapi_userinfo&state=&component_appid=wx5bfdc86d4b702418#wechat_redirect",imgUrl:"",success:function(){},cancel:function(){}})},1e3)}},h.setParams=function(a,b){h.params[a]=b},h.getParams=function(a){return h.params[a]},h.getUserID=function(a,b){var e={appid:b,code:a};e=JSON.stringify(e),c.post(g("buildsession","server"),e).success(function(a,b,c,d){h.getWxUserInfo(a.access_token,a.openid)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},h.getWxUserInfo=function(a,b){var e=f.proposedLanguage()||f.use();e="zh-CN"==e?"zh_CN":"en";var i={access_token:a,openid:b,lang:e};i=JSON.stringify(i),c.post(g("wxuserinfo","server"),i).success(function(a,b,c,d){h.setParams("wxUserInfo",a)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},h.wxConfigJSSDK=function(){h.noncestr=Math.random().toString(36).substr(2),h.timestamp=(new Date).getTime()+"";var a={appid:h.getParams("appid"),noncestr:h.noncestr,timestamp:h.timestamp,url:window.location.origin+window.location.pathname+window.location.search};a=JSON.stringify(a),c.post(g("jssign","server"),a).success(function(a,b,c,e){"200"==a.rescode?wx.config({debug:!1,appId:h.getParams("appid"),timestamp:h.timestamp,nonceStr:h.noncestr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]}):alert(d("translate")("serverError")+a.rescode)}).error(function(a,b,c,e){alert(d("translate")("serverError")+b)})},e.fromTemplateUrl("pages/mainMenu.html",{scope:a,animation:"slide-in-left"}).then(function(b){a.modal=b}),h.showMainMenu=function(){a.modal.show()}}]).controller("bookHotelListController",["$scope","$filter","$timeout","$location","$http","$stateParams","loadingService","backendUrl",function(a,b,c,d,e,f,g,h){var i=this;i.init=function(){a.root.wxShare(),i.showLoadingBool={},i.showLoadingBool.searchProjectInfoBool=!1,i.showLoadingBool.searchCityListsBool=!1,i.showLoadingBool.searchHotelListBool=!1,g(i.showLoadingBool),i.datePickerShow=!1,i.hotels={},i.checkin=(new Date).getTime(),i.checkout=(new Date).getTime()+864e5,i.cityInfo={id:"0",name:"全部"},i.searchProjectInfo(),i.searchHotelList(),i.searchCityLists()},i.showDP=function(a){i.datePickerShow=!!a&&a},i.showCP=function(a){i.cityPickerShow=!!a&&a},i.doAfterPickDates=function(a,b){i.checkin=a,i.checkout=b,c(function(){i.showDP(!1)},500)},i.doAfterPickCity=function(a,b){i.cityInfo={id:a,name:b},i.showCP(!1)},i.searchProjectInfo=function(){e({method:b("ajaxMethod")(),url:h("projectInfo")}).then(function(a,b,c,d){i.projectInfo=a.data.projectInfo,i.showLoadingBool.searchProjectInfoBool=!0,g(i.showLoadingBool)},function(a,b,c,d){i.showLoadingBool.searchProjectInfoBool=!0,g(i.showLoadingBool),alert(b)})},i.searchCityLists=function(){e({method:b("ajaxMethod")(),url:h("cityLists")}).then(function(a,b,c,d){i.cityLists=a.data.data.cityLists,i.showLoadingBool.searchCityListsBool=!0,g(i.showLoadingBool)},function(a,b,c,d){i.showLoadingBool.searchCityListsBool=!0,g(i.showLoadingBool),alert(b)})},i.searchHotelList=function(){e({method:b("ajaxMethod")(),url:h("hotelList")}).then(function(a,b,c,d){i.hotels=a.data.data.hotelLists,i.hotelNum=a.data.data.hotelNum,i.showLoadingBool.searchHotelListBool=!0,g(i.showLoadingBool)},function(a,b,c,d){i.showLoadingBool.searchHotelListBool=!0,g(i.showLoadingBool),alert(b)})}}]).controller("bookRoomListController",["$scope","$http","$filter","$stateParams","$timeout","loadingService","backendUrl",function(a,b,c,d,e,f,g){var h=this;h.init=function(){a.root.wxShare(),h.hotelId=d.hotelId,h.checkIn=d.checkIn,h.checkOut=d.checkOut,console.log(d),h.showLoadingBool={},h.showLoadingBool.searchHotelInfoBool=!1,h.showLoadingBool.searchRoomListBool=!1,f(h.showLoadingBool),h.searchHotelInfo(),h.searchRoomList()},h.showDP=function(a){h.datePickerShow=!!a&&a},h.doAfterPickDates=function(a,b){h.checkIn=a,h.checkOut=b,e(function(){h.showDP(!1)},500)},h.searchHotelInfo=function(){e(function(){b({method:c("ajaxMethod")(),url:g("hotelInfo"),data:{hotelId:h.hotelId}}).then(function(a,b,c,d){h.hotel=a.data.data.hotel,h.showLoadingBool.searchHotelInfoBool=!0,f(h.showLoadingBool),console.log("searchHotelInfoBool")},function(a,b,c,d){h.showLoadingBool.searchHotelInfoBool=!0,f(h.showLoadingBool),alert(b)})},500)},h.searchRoomList=function(){b({method:c("ajaxMethod")(),url:g("roomList"),data:{hotelId:h.hotelId}}).then(function(a,b,c,d){h.rooms=a.data.data,h.showLoadingBool.searchRoomListBool=!0,f(h.showLoadingBool)},function(a,b,c,d){h.showLoadingBool.searchHotelInfoBool=!0,f(h.showLoadingBool),alert(b)})}}]).controller("hotelInfoController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("roomInfoController",["$scope","$http","$filter","$stateParams","$timeout","loadingService","backendUrl",function(a,b,c,d,e,f,g){console.log("roomInfoController"),console.log(d);var h=this;h.init=function(){a.root.wxShare(),h.showLoadingBool={},h.showLoadingBool.searchBool=!1,f(h.showLoadingBool),h.checkin=d.checkIn,h.checkout=d.checkOut,h.search()},h.showDP=function(a){h.datePickerShow=!!a&&a},h.doAfterPickDates=function(a,b){h.checkin=a,h.checkout=b,h.showDP(!1)},h.search=function(){e(function(){b({method:c("ajaxMethod")(),url:g("roomInfo")}).then(function(a,b,c,d){console.log(a),h.room=a.data.data.room,h.showLoadingBool.searchBool=!0,f(h.showLoadingBool)},function(a,b,c,d){h.showLoadingBool.searchBool=!0,f(h.showLoadingBool),alert(b)})},500)},h.getAuthCode=function(){b({method:c("ajaxMethod")(),url:g("authCode")}).then(function(a,b,c,d){console.log(a)},function(a,b,c,d){alert(b)})}}]).controller("orderInfoController",["$scope","$http","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e,f){console.log("bookInfoController");var g=this;g.init=function(){a.root.wxShare(),g.showLoadingBool={},g.showLoadingBool.searchBool=!1,e(g.showLoadingBool),g.search()},g.search=function(){b({method:c("ajaxMethod")(),url:f("orderInfo")}).then(function(a,b,c,d){g.room=a.data.data.room,g.hotel=a.data.data.hotel,g.roomOrder=a.data.data.roomOrder,g.showLoadingBool.searchBool=!0,e(g.showLoadingBool)},function(a,b,c,d){g.showLoadingBool.searchBool=!0,e(g.showLoadingBool),alert(b)})}}]).controller("bookRoomSoldOutController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberHomeController",["$http","$scope","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e,f){console.log("memberHomeController");var g=this;g.init=function(){b.root.wxShare(),g.showLoadingBool={},g.showLoadingBool.searchBool=!1,e(g.showLoadingBool.searchBool),g.search()},g.search=function(){a({method:c("ajaxMethod")(),url:f("memberInfo")}).then(function(a,b,c,d){console.log(a),g.member=a.data.data.member,console.log(g.member),g.showLoadingBool.searchBool=!0,e(g.showLoadingBool.searchBool)},function(a,b,c,d){g.showLoadingBool.searchBool=!0,e(g.showLoadingBool.searchBool),alert(b)})}}]).controller("memberLoginController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberRegisterController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberInfoEditController",["$http","$scope","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e,f){console.log("memberInfoEditController");var g=this;g.memberId=d.memberId,g.init=function(){b.root.wxShare(),g.showLoadingBool={},g.showLoadingBool.searchBool=!1,e(g.showLoadingBool),g.search()},g.search=function(){a({method:c("ajaxMethod")(),url:f("memberInfo"),data:{hotelId:d.hotelId,roomId:d.roomId}}).then(function(a,b,c,d){console.log(a),g.member=a.data.data.member,console.log(g.member),g.showLoadingBool.searchBool=!0,e(g.showLoadingBool)},function(a,b,c,d){g.showLoadingBool.searchBool=!0,e(g.showLoadingBool),alert(b)})},g.getAuthCode=function(){a({method:c("ajaxMethod")(),url:f("authCode")}).then(function(a,b,c,d){console.log(a)},function(a,b,c,d){alert(b)})}}]).controller("memberResetPWController",["$http","$scope",function(a,b){var c=this;c.init=function(){b.root.wxShare()}}]).controller("memberOrderListController",["$http","$scope","$filter","$stateParams","loadingService","backendUrl",function(a,b,c,d,e,f){var g=this;g.init=function(){b.root.wxShare(),g.showLoadingBool={},g.showLoadingBool.searchBool=!1,e(g.showLoadingBool),g.search()},g.search=function(){a({method:c("ajaxMethod")(),url:f("orderList")}).then(function(a,b,c,d){console.log(a),g.orderLists=a.data.data.orderLists,g.showLoadingBool.searchBool=!0,e(g.showLoadingBool)},function(a,b,c,d){g.showLoadingBool.searchBool=!0,e(g.showLoadingBool),alert(b)})}}])}(),function(){angular.module("app.directive",[]).directive("cityPicker",function(){return{restrict:"EA",templateUrl:"pages/drt/city-picker.html",replace:!0}}).controller("cityPickerController",["$scope","$ionicScrollDelegate",function(a,b){var c=this;c.init=function(a,b){c.callback=b,c.cityLists=a},c.scrollTo=function(a){var c=document.getElementById(a).offsetTop;b.$getByHandle("cityList").scrollTo(0,c,!0)}}]).directive("travelDatePicker",function(){return{restrict:"EA",templateUrl:"pages/drt/travel-date-picker.html",replace:!0}}).controller("travelDatePickerController",["$scope","$filter",function(a,b){function c(a,b){var c=new Date(a),d=new Date(b);return c.getFullYear()===d.getFullYear()&&c.getMonth()==d.getMonth()&&c.getDate()==d.getDate()}function d(a){var a=new Date(a);return a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),a.getTime()}function e(a,b){var c=new Date(a,b-1,1),d=new Date(a,b,0),e=c.getDay()+d.getDate();return Math.ceil(e/7)}function f(a,b){var c=new Date(a);return c.setTime(a+24*b*60*60*1e3),c.getTime()}function g(a){switch(a.getMonth()+1){case 1:i(a.getFullYear())?a.setTime(f(a.getTime(),29)):a.setTime(f(a.getTime(),28));break;case 3:case 5:case 8:case 10:a.setTime(f(a.getTime(),30));break;case 12:case 2:case 4:case 6:case 7:case 9:case 11:a.setTime(f(a.getTime(),31))}}function h(a){a=new Date(a);var b=a.getFullYear(),c=a.getMonth()+1;return 12*(b-1970)+c}function i(a){return a%4==0&&(a%400==0||a%100!=0)}var j=this;j.init=function(a,c,d,e,f){j.st=d?d:(new Date).getTime(),j.et=e?e:j.st+158112e5,j.checkin=a,j.checkout=c,j.dates=[],j.callback=f,j.setDateData(),j.msgShow=!0,j.msg=b("translate")("plsSelACheckInDate")},j.setDateData=function(){for(var a=h(j.et)-h(j.st)+1,b=new Date(j.st),c=0;c<a;c++){j.dates[c]={},j.dates[c].month=b.getTime(),j.dates[c].weeks=[];for(var d=new Date(b.getFullYear(),b.getMonth()+1,0),i=d.getFullYear(),k=d.getMonth()+1,l=e(i,k),m=new Date(b.getFullYear(),b.getMonth(),1),n=m.getDay(),o=0;o<l;o++){j.dates[c].weeks[o]=[];for(var p=0;p<7;p++)n>0?(j.dates[c].weeks[o][p]=null,n--):m>d?j.dates[c].weeks[o][p]=null:(j.dates[c].weeks[o][p]=m.getTime(),m.setTime(new Date(f(m.getTime(),1)).getTime()))}g(b)}},j.clickDate=function(a){return!(j.dDisable(a)||c(a,j.checkin)||c(a,j.checkout))&&void(j.checkin&&j.checkout?(j.checkin=a,j.checkout=null,j.msgShow=!0,j.msg=b("translate")("plsSelACheckOutDate")):j.checkin&&!j.checkout?a<j.checkin?j.checkin=a:(j.checkout=a,j.msgShow=!1,j.msg="",j.callback(j.checkin,j.checkout)):j.checkin=a)},j.dDisable=function(a){var b=(new Date).getTime();return d(b)>d(a)||d(a)<d(j.st)||d(a)>d(j.et)},j.isDuring=function(a){var b=!1;return j.checkin&&j.checkout&&a>j.checkin&&a<j.checkout&&(b=!0),b},j.isCheckin=function(a){return!(!j.checkin||!c(j.checkin,a))},j.isCheckout=function(a){return!(!j.checkout||!c(j.checkout,a))}}])}(),function(){angular.module("app.services",[]).service("backendUrl",["BACKEND_CONFIG",function(a){return function(b,c){return a.test?"server"==c?a.serverUrl+b:a.testUrl+b+a.testExtesion:a.serverUrl+b}}]).service("loadingService",["$ionicLoading",function(a){return function(b){var c=0,d=0;for(var e in b)++c,1==b[e]&&++d;c==d?a.hide():a.show({template:"Loading..."})}}])}(),function(){angular.module("app.filters",[]).filter("ajaxMethod",["BACKEND_CONFIG",function(a){return function(){var b=a.test?"GET":"POST";return b}}]).filter("dayNumbers",function(){return function(a){return a/864e5}})}();